# v1.9.0 release changelogs

<!-- The following line should ONLY be put PRE-release changelogs -->
‚ö†Ô∏è Since this is a release candidate (RC), we do NOT recommend using it in a production environment. Is something not working as expected? We welcome [bug reports](https://github.com/meilisearch/meilisearch/issues/new/choose) and [feedback about new features](https://github.com/meilisearch/product/discussions).

Meilisearch v1.9 includes performance improvements for hybrid search and the addition/updating of settings. This version benefits from multiple requested features, such as the new `frequency` matching strategy and the ability to retrieve similar documents.

<!-- The following lines should NOT be put in the PRE-release changelogs -->
üß∞ All official Meilisearch integrations (including SDKs, clients, and other tools) are compatible with this Meilisearch release. Integration deployment happens between 4 to 48 hours after a new version becomes available.

<!-- The following lines should NOT be put in the PRE-release changelogs -->
Some SDKs might not include all new features. Consult the project repository for detailed information. Is a feature you need missing from your chosen SDK? Create an issue letting us know you need it, or, for open-source karma points, open a PR implementing it (we'll love you for that ‚ù§Ô∏è).

# New features and updates üî•

## Hybrid search improvements

Since we're focusing on AI innovation, this version introduces multiple improvements and changes related to hybrid search.
More detailed changelog [here](https://meilisearch.notion.site/v1-9-AI-search-changes-e90d6803eca8417aa70a1ac5d0225697#38e6d3adf40e4ef1be14a3c4be39df94).

Done by @dureuill and @irevoire in #4633 and #4649

### ‚ö†Ô∏è Breaking changes of hybrid search usage

- Before v1.9, an empty array in `_vectors.embedder` used to be interpreted as a single embedding of dimension 0 when specifying embeddings in documents. In v1.9 it is now interpreted as 0 embedding. The previous behavior was surprising and not useful.
- From v1.9, by default, `_vectors` will not be returned anymore during a search. This will considerably improve performance. To display it, a new boolean search parameter has been introduced: `retrieveVectors` (default: `false`).

### Improvements

The `_vectors` field in documents plays a special role, as it is used by Meilisearch to extract the embeddings (vectors of numbers) related to the document and each embedder declared in the settings.

In v1.8, the `_vectors` field must have the following shape for the embeddings to be used in embedders:

```json
{
  "id": 42,
  "_vectors": {
    "default": [0.1, 0.2 ],
      "text": [[0.1, 0.2, 0.3], [0.4, 0.5, 0.6]],
      "image": null
  }
}
```

```json
{
  "id": 42,
  "_vectors": {
    "default": [0.1, 0.2 ],
      "text": {
        "embeddings": [[0.1, 0.2, 0.3], [0.4, 0.5, 0.6]],
        "userProvided": true
      },
      "translation": {
        "embeddings": [0.1, 0.2, 0.3, 0.4],
        "userProvided": false
      }
    }
}
```

In v1.9, this syntax is extended to allow for the value to be an object in addition to the current embeddings or array of embeddings.

```json
{
  "id": 42,
  "_vectors": {
    "default": [0.1, 0.2 ],
      "text": {
        "embeddings": [[0.1, 0.2, 0.3], [0.4, 0.5, 0.6]],
        "userProvided": true
      },
      "translation": {
        "embeddings": [0.1, 0.2, 0.3, 0.4],
        "userProvided": false
      }
    }
}
```

This change allows **importing** embeddings to autoembedders as a one-shot process, by setting them as `userProvided: false`.

The dump system makes use of this, so with this change embeddings won‚Äôt be regenerated when importing a dump created with Meilisearch v1.9.

Meilisearch v1.9.0 also improves performance when indexing and using hybrid search, avoiding useless operations and optimizing the important ones.

## Filter by score

To filter returned documents by their ranking score, a new `rankingScoreThreshold` parameter has been added to the search and similar routes.

When the `rankingScoreThreshold` search parameter is provided, the results of the search/similar request are modified in the following way:

1. No document whose `_rankingScore` is under the `rankingScoreThreshold` is returned
2. Any document encountered during the search that is under the threshold is removed from the set of candidates and won‚Äôt count towards the `estimatedTotalHits`, `totalHits` and the facet distribution.


```bash
curl \
 -X POST 'http://localhost:7700/indexes/movies/search' \
 -H 'Content-Type: application/json' \
 --data-binary '{
    "q": "Badman dark returns 1",
    "showRankingScore": true,
    "limit": 5,
    "rankingScoreThreshold": 0.2
 }'
```

Results:

```json
{
    "hits": [
        {
          "title": "Batman the dark knight returns: Part 1",
          "id": "A",
          "_rankingScore": 0.93430081300813
        },
        {
          "title": "Batman the dark knight returns: Part 2",
          "id": "B",
          "_rankingScore": 0.6685627880184332
        },
        {
          "title": "Badman",
          "id": "E",
          "_rankingScore": 0.25
        }
    ],
    "query": "Badman dark returns 1",
    "processingTimeMs": 11,
    "limit": 5,
    "offset": 0,
    "estimatedTotalHits": 3
}
```

Without `rankingScoreThreshold`, the following results would have been returned:

```json
{
	"hits": [
	    {
	      "title": "Batman the dark knight returns: Part 1",
	      "id": "A",
	      "_rankingScore": 0.93430081300813
	    },
	    {
	      "title": "Batman the dark knight returns: Part 2",
	      "id": "B",
	      "_rankingScore": 0.6685627880184332
	    },
	    {
	      "title": "Badman",
	      "id": "E",
	      "_rankingScore": 0.25
	    },
	    {
	      "title": "Batman Returns",
	      "id": "C",
	      "_rankingScore": 0.11553030303030302
	    },
	    {
	      "title": "Batman",
	      "id": "D",
	      "_rankingScore": 0.11553030303030302
	    }
	],
	"query": "Badman dark returns 1",
	"processingTimeMs": 11,
	"limit": 5,
	"offset": 0,
	"estimatedTotalHits": 62
}
```

‚ö†Ô∏è For performance reasons, if Meilisearch finds `limit` hits above the `rankingScoreThreshold`, then the ranking score of the remaining documents is not evaluated, and so they are not removed from the set of candidates, even if their ranking score would be below the threshold. As a result, in this configuration the `estimatedTotalHits`, `totalHits` and the facet distribution may be overapproximation of their values.

Done by @dureuill in #4666

## Get similar documents

To retrieve similar documents in your datasets, two new routes have been introduced
- `POST /indexes/:indexUid/similar` using parameters in the request body.
- `GET /indexes/:indexUid/similar`, using query URL parameters.

```json5
POST /indexes/:indexUid/similar
{
  // Mandatory: the external id of the target document
  "id": "23",
  // Optional, defaults to 0: how many results to skip
  "offset": 0,
  // Optional, defaults to 20: how many results to display
  "limit": 2,
  // Optional, defaults to null: an additional filter for the returned documents
  "filter": "release_date > 1521763199",
  // Optional, defaults to the default embedder: name of the embedder to use
  // for computing recommendations.
  "embedder": "default",
  // Optional, defaults to null: same as the search query parameter of the same name
  "attributesToRetrieve": [],
  // Both optional, defaults to false: allow displaying the ranking score
  // (resp. detailed ranking score)
  "showRankingScore": false,
  "showRankingScoreDetails": false
}
```

Done by @dureuill in #4647

## `frequency` matching strategy when searching

A `frequency` variant to the `matchingStrategy` search parameter has been added. This favors the least frequent query words when retrieving the documents.

```bash
curl \
 -X POST 'http://localhost:7700/indexes/movies/search' \
 -H 'Content-Type: application/json' \
 --data-binary '{
    "q": "chaval blanc",
    "matchingStrategy": "frequency"
 }'
```

Previous existing values for `matchingStrategy` are `last` and `all` (`last` is the default value).

Done by @ManyTheFish in #4667

## Set `distinctAttribute` at search

TBD

## Improve indexing speed when updating/adding settings

Meilisearch now limits operations when importing settings by avoiding useless writing operations in its internal database and by reducing disk usage.

Done by @irevoire and @Kerollmops in #4646, #4680 and #4631

## Other improvements

* [Prometheus experimental feature](https://github.com/orgs/meilisearch/discussions/625): Use HTTP path pattern instead of full path in metrics (#4619) @gh2k
* ‚ö†Ô∏è Remove `exportPuffinReport` experimental feature. Use [logs routes](https://github.com/orgs/meilisearch/discussions/721) and [logs modes](https://github.com/orgs/meilisearch/discussions/723) instead (#4655) @Kerollmops

# Fixes üêû

* When no specific searchable attributes are declared (`searchableAttributes: ["*"]`), all the fields have the same importance instead of being randomly given more importance. Previous behavior led to difficulties for the users to anticipate the behavior. To define which attribute is more important than another regarding the relevancy, set [the exhaustive list of `searchableAttributes`](https://www.meilisearch.com/docs/learn/configuration/displayed_searchable_attributes#the-searchableattributes-list). More information about the changes [here](https://github.com/meilisearch/meilisearch/issues/4639) (#4631) @irevoire
* Fix `searchableAttributes` behavior with nested fields when they were not explicitly defined. More information [here](https://github.com/meilisearch/meilisearch/issues/4639) (#4631) @irevoire
* Fix security issue in dependency: bump Rustls to non-vulnerable versions (#4622) @Kerollmops

# Misc

* Dependencies updates
  * Update actix-web 4.5.1 -> 4.6.0 (#4675) @dureuill
* CIs and tests
  * Add "precommands" to benchmark (#4624) @dureuill
  * Allow to comment with the results of benchmark invocation (#4651) @dureuill
* Documentation
  * Update README.md (#4664) @tpayet
* Misc
  * Fix some typos in comments (#4568) @yudrywet
  * Fix some typos in comments (#4582) @writegr

‚ù§Ô∏è Thanks again to our external contributors:
- [Meilisearch](https://github.com/meilisearch/meilisearch): @gh2k, @writegr, @yudrywet.
- [Charabia](https://github.com/meilisearch/charabia): TBD
