# v1.6.0 release changelogs

<!-- The following line should ONLY be put PRE-release changelogs -->
‚ö†Ô∏è Since this is a release candidate (RC), we do NOT recommend using it in a production environment. Is something not working as expected? We welcome [bug reports](https://github.com/meilisearch/meilisearch/issues/new/choose) and [feedback about new features](https://github.com/meilisearch/product/discussions).

Meilisearch v1.6 focuses on improving indexing performance. This new release also adds hybrid search and simplifies the process of generating embeddings for semantic search.

<!-- The following lines should NOT be put in the PRE-release changelogs -->
üß∞ All official Meilisearch integrations (including SDKs, clients, and other tools) are compatible with this Meilisearch release. Integration deployment happens between 4 to 48 hours after a new version becomes available.

<!-- The following lines should NOT be put in the PRE-release changelogs -->
Some SDKs might not include all new features‚Äîconsult the project repository for detailed information. Is a feature you need missing from your chosen SDK? Create an issue letting us know you need it, or, for open-source karma points, open a PR implementing it (we'll love you for that ‚ù§Ô∏è).

# New features and improvements üî•

## Experimental: improve vector search

Meilisearch introduces a hybrid search mechanism that allows users to mix full-text and semantic search at search time to provide more accurate and comprehensive results.

Plus, you can directly define the embedders you want to use, so you don't need to interact with a third party on your side to generate embeddings: Meilisearch will interact with it for you.

### Settings

Before using hybrid search, you need to define an embedder in your settings. You can even define multiple embedders in the index settings.

You must set them via the `/PATCH indexes/:index_uid/settings` route. Here is an example of a payload defining 3 embedders named `default`, `image` and `translation`:

```json
{
  "embedders": {
    "default": {
      "source":  "openAi",
      "apiKey": "<your-OpenAI-API-key>",
      "model": "text-embedding-ada-002",
      "documentTemplate": "A movie titled '{{doc.title}}' whose description starts with {{doc.overview|truncatewords: 20}}"
    },
    "image": {
      "source": "userProvided",
      "dimensions": 512
    },
    "translation": {
      "source": "huggingFace",
      "model": "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2",
      "documentTemplate": "A movie titled '{{doc.title}}' whose description starts with {{doc.overview|truncatewords: 20}}"
    }
  }
}
```

`documentTemplate` is a view of your document that will serve as the base for computing the embedding. This field is a JSON string expecting [Liquid format](https://shopify.github.io/liquid/).

3 kinds of embedders are available for `source`:
- `openAI`: Use the OpenAI API to auto-embed your documents, so your OpenAI API key must be specified.
- `huggingFace`: download the provided `model` from HuggingFace Hub locally to auto-embed the documents and query.
- `userProvided`: you send document vectors and query vectors, meaning you have computed the embeddings on your side. It's similar to the v1.3 version of Meilisearch in the way it works; the exception is that a specific embedder must be defined, which wasn‚Äôt required before, cf the next section about breaking changes.

‚ö†Ô∏è If using the HuggingFace model, the computation will be done on your machine and will use your CPU (not your GPU), which can lead to bad indexing performance.

### Hybrid & semantic search

You can perform a hybrid search by using the `hybrid` field when calling the `POST /index/:index_uid/search` route.

Here is an example of a hybrid search payload:

```json
{
    "q": "Plumbers and dinosaurs",
    "hybrid": {
        "semanticRatio": 0.9,
        "embedder": "default"
    }
}
```

`embedder` is the embedder you choose to perform the search among the ones you defined in your settings.
`semanticRatio`: the value should be between 0 and 1. The default value is 0,5. 1 corresponds to a full semantic search, whereas 0 is about a full-text search.

### ‚ö†Ô∏è Breaking changes for beta users of the previous version of vector search

For people who used Meilisearch with the experimental vector search feature (between v1.3.0 and v1.5.0), some changes happened in the API usage:

- During a search, when providing the `q` and `vector` parameters, you now also must provide the `hybrid` parameter.

- Before, sending your vectors without defining any models to use vector search was possible. Now, we have to define a model in the settings.

```json
"embedders": {
    "default": {
      "source": "userProvided",
      "dimensions": 512
    }
}
```

- Meilisearch now supports multiple embedders, so the format for sending documents and vectors changed. Vectors are not arrays anymore but JSON objects.

Before, in your document you provided:

```json
"_vectors": [
  [0.0, 0.1]
]
```

Now the format is:

```json
"_vectors": {
  "image2text": [0.0, 0.1, ...]
}
```

To know more about the new usage, refer to the sections above about settings or to [the documentation](TBD)

> [!TIP]
> The new vector search functionality uses [Arroy](https://github.com/meilisearch/arroy), a Rust library developed by the Meilisearch engine team. Check out @Kerollmops [blog post describing the whole process](https://blog.kerollmops.com/spotify-inspired-elevating-meilisearch-with-hybrid-search-and-rust).

Done in #4226 by @dureuill, @irevoire, @Kerollmops and @ManyTheFish.

## Improve indexing speed

This version introduces significant indexing performance improvements. Meilisearch v1.6 has been optimized to:
- store and pre-compute less data than in previous versions
- re-index and delete only the necessary data when updating a document. For example, when you update one document field, Meilisearch will no longer re-index the whole document

On an e-commerce dataset of 2.5Gb of documents, these changes led to more than a 50% time reduction when adding documents for the first time. When updating documents frequently and partially, re-indexing performance hovers between 50% and 75%.

‚ö†Ô∏è Performance improvements depend on your dataset, your machine, and how you're indexing documents.

Done in #4090 by @ManyTheFish, @dureuill and @Kerollmops.

## Disk space usage reduction

Meilisearch now stores less internal data. This leads to smaller database disk sizes.

With a ~15Mb dataset, the created database is 40% and 50% smaller. Additionally, the database size has become more stable and will display more modest growth with new document additions.

## Customize proximity precision to gain indexing performance

Still, in the purpose of reducing the indexing speed, you can now customize the accuracy of the [proximity ranking rules](https://www.meilisearch.com/docs/learn/core_concepts/relevancy#3-proximity) based on your needs.

However, the computation needed for the proximity ranking rule is huge and can lead to a big indexing time. Since the proximity ranking rule purpose for the search relevancy is not always necessary for your use case, you now have the possibility to make it less relevant to reduce the indexing speed. Indeed, depending on your use case, the relevancy impact can even be invisible.

Use the `proximityPrecision` settings:

```
curl \
  -X PATCH 'http://localhost:7700/indexes/books/settings/proximity-precision' \
  -H 'Content-Type: application/json'  \
  --data-binary '{
    "proximityPrecision": "byAttribute"
  }'
```

The default value of `proximityPrecision` is `byWord`. `byAttribute` will improve your indexing performance but can impact the relevancy.

Technical explanations: `byWord` considers the proximity as an exact distance between words, whereas `byAttribute` considers the proximity as if the words are in the same attribute or not, making it less accurate.

Done in #4225 by @ManyTheFish.

## Experimental: Limit the number of batched tasks

Meilisearch may occasionally batch too many tasks together, which may lead to system instability. Relaunch Meilisearch with the `--experimental-max-number-of-batched-tasks` configuration option to address this issue:

```sh
./meilisearch --experimental-max-number-of-batched-tasks 100
```

You may also configure `--experimental-max-number-of-batched-tasks` as an environment variable or directly in the config file with `MEILI_EXPERIMENTAL_MAX_NUMBER_OF_BATCHED_TASKS`.

Done in #4249 by @Kerollmops

## Task queue webhook

This release introduces a configurable webhook url that will be called whenever Meilisearch finishes processing a task.

Relaunch Meilisearch using `--task-webhook-url` and `--task-webhook-authorization-header` to use the webhook:

```sh
./meilisearch \
  --task-webhook-url=https://example.com/example-webhook?foo=bar&number=8 \
  --task-webhook-authorization-header=Bearer aSampleAPISearchKey
```

You may also define the webhook URL and header with environment variables or in the configuration file with `MEILI_TASK_WEBHOOK_URL` and `MEILI_TASK_WEBHOOK_AUTHORIZATION_HEADER`.

Done by @irevoire in #4238

# Fixes üêû

* The dump tasks are now cancellable (#4208) @irevoire
* Fix: the payload size limit is now also applied on `/documents/delete-batch` (#4231) @Karribalu
* Fix: typo tolerance is ineffective for attributes with similar content (related issue: #4256)
* Fix: the geosort is no longer ignored after the first bucket of a preceding `sort` ranking rule (#4226)

# Misc

* Dependencies upgrade
  * Updating CI dependencies
  * Update to heed 0.20 (#4223) @Kerollmops
  * Set rust toolchain to 1.71.1 in Dockerfile (#4261) @dureuill
  * Update mini-dashboard to v0.2.12 (#4277) @mdubus
* Documentation
  * Remove banner (#4191) @curquiza
* Misc
  * Extract the creation and last updated timestamp from v2 dumps (#4132) @vivek-26
  * Fix puffin in the index scheduler (#4234) @irevoire
  * Remove the actix-web dependency from (#4239) @Kerollmops

‚ù§Ô∏è Thanks again to our external contributors:
- [Meilisearch](https://github.com/meilisearch/meilisearch): @Karribalu, and @vivek-26
- [Charabia](https://github.com/meilisearch/charabia): TBD
